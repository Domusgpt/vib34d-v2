<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>VIB34D Holographic Engine - Refactored</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* VIB34D Refactored CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Orbitron', monospace;
            overflow: hidden;
            position: relative;
        }
        
        /* 5-Layer Holographic Canvas System */
        .holographic-layers {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
        }
        
        .holographic-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: auto;
        }
        
        #background-canvas { z-index: 1; opacity: 0.6; mix-blend-mode: normal; }
        #shadow-canvas { z-index: 3; opacity: 0.4; mix-blend-mode: multiply; }
        #content-canvas { z-index: 5; opacity: 0.9; mix-blend-mode: screen; }
        #highlight-canvas { z-index: 7; opacity: 0.7; mix-blend-mode: overlay; }
        #accent-canvas { z-index: 15; opacity: 0.5; mix-blend-mode: color-dodge; }
        
        /* Control Panel */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            min-width: 320px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        /* Collapsible Panel States */
        .control-panel.collapsed {
            transform: translateX(calc(100% - 50px));
            opacity: 0.8;
        }
        
        .control-panel.collapsed:hover {
            transform: translateX(calc(100% - 80px));
            opacity: 0.9;
        }
        
        /* Collapse Toggle Button */
        .collapse-toggle {
            position: absolute;
            left: -40px;
            top: 10px;
            width: 35px;
            height: 35px;
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #00ffff;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .collapse-toggle:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        /* Hide control panel in preview mode */
        .preview-mode .control-panel {
            display: none !important;
        }
        
        /* Hide status in preview mode */
        .preview-mode .status {
            display: none !important;
        }
        
        .control-panel h2 {
            color: #00ffff;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        /* Enhanced Control Header */
        .control-header {
            background: linear-gradient(145deg, rgba(0, 255, 255, 0.05), rgba(0, 255, 255, 0.02));
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        
        .system-status {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        #currentSystemIndicator {
            font-size: 0.8rem;
            font-weight: bold;
            color: #00ffff;
        }
        
        #parameterSyncStatus {
            font-size: 0.6rem;
            color: rgba(0, 255, 0, 0.8);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .quick-actions {
            display: flex;
            gap: 6px;
        }
        
        .quick-btn {
            background: rgba(0, 255, 255, 0.15);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.6rem;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .quick-btn:hover {
            background: rgba(0, 255, 255, 0.25);
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.4);
            transform: translateY(-1px);
        }
        
        .quick-btn:active {
            transform: translateY(0);
            box-shadow: 0 0 4px rgba(0, 255, 255, 0.6);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            padding: 8px 5px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        
        .tab-btn.active {
            color: #00ffff;
            border-bottom-color: #00ffff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Controls */
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .control-input {
            width: 100%;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            padding: 8px;
            color: #fff;
            font-family: 'Orbitron', monospace;
            font-size: 0.8rem;
        }
        
        .control-input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }
        
        .control-display {
            display: inline-block;
            float: right;
            color: #00ffff;
            font-weight: bold;
        }
        
        /* Buttons */
        .btn {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            margin: 2px;
        }
        
        .btn:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
        
        .btn.active {
            background: rgba(0, 255, 255, 0.5);
        }
        
        /* Geometry Presets */
        .geometry-presets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        /* Variation Grid */
        .variation-controls {
            margin-bottom: 15px;
        }
        
        .variation-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .variation-info {
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 0.8rem;
        }
        
        /* Status */
        .status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            font-family: 'Orbitron', monospace;
            font-size: 0.8rem;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .status.success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            color: #00ff00;
        }
        
        .status.error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            color: #ff0000;
        }
        
        .status.warning {
            background: rgba(255, 255, 0, 0.2);
            border: 1px solid #ffff00;
            color: #ffff00;
        }
        
        .status.info {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            color: #00ffff;
        }
        
        /* Gallery Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
        }
        
        .modal.active {
            display: block;
        }
        
        .modal-content {
            position: relative;
            margin: 2% auto;
            width: 95%;
            height: 95%;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid #00ffff;
            border-radius: 10px;
            overflow: hidden;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .control-panel {
                right: 10px;
                top: 10px;
                min-width: 280px;
            }
            
            .geometry-presets {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 5-Layer Holographic Canvas System -->
    <div class="holographic-layers">
        <canvas id="background-canvas" class="holographic-canvas"></canvas>
        <canvas id="shadow-canvas" class="holographic-canvas"></canvas>
        <canvas id="content-canvas" class="holographic-canvas"></canvas>
        <canvas id="highlight-canvas" class="holographic-canvas"></canvas>
        <canvas id="accent-canvas" class="holographic-canvas"></canvas>
    </div>
    
    <!-- Active Holographic System Layers -->
    <div class="holographic-layers active-holo" style="display: none;">
        <canvas id="holo-background-canvas" class="holographic-canvas"></canvas>
        <canvas id="holo-shadow-canvas" class="holographic-canvas"></canvas>
        <canvas id="holo-content-canvas" class="holographic-canvas"></canvas>
        <canvas id="holo-highlight-canvas" class="holographic-canvas"></canvas>
        <canvas id="holo-accent-canvas" class="holographic-canvas"></canvas>
    </div>
    
    <!-- Control Panel -->
    <div class="control-panel" id="controlPanel">
        <div class="collapse-toggle" id="collapseToggle" onclick="toggleControlPanel()">‚Äπ</div>
        <h2>VIB34D Holographic Engine</h2>
        
        <!-- Enhanced Control Header -->
        <div class="control-header">
            <div class="system-status">
                <span id="currentSystemIndicator">üî∑ VIB34D System</span>
                <span id="parameterSyncStatus">Synced</span>
            </div>
            <div class="quick-actions">
                <button class="quick-btn" onclick="quickRandomize()" title="Quick randomize visual parameters">‚ö° Quick</button>
                <button class="quick-btn" onclick="randomizeParameters()" title="Full randomization">üé≤ Random</button>
                <button class="quick-btn" onclick="switchToSystem(unifiedParameters.systemType === 'VIB34D' ? 'Holographic' : 'VIB34D')" title="Switch between systems">üîÑ Switch</button>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="variations" title="VIB34D Polytopal Variations">üî∑ VIB34D</button>
            <button class="tab-btn" data-tab="polytopal" title="4D Mathematics Control">üßÆ 4D Math</button>
            <button class="tab-btn" data-tab="holographic" title="Holographic Parameters">üåÄ Holo Params</button>
            <button class="tab-btn" data-tab="holograms" title="Active Holographic System">‚ú® Live Holo</button>
            <button class="tab-btn" data-tab="export" title="Export & Import System">üì§ Export</button>
        </div>
        
        <!-- Variations Tab -->
        <div class="tab-content active" id="variations-tab">
            <div class="variation-controls">
                <div class="variation-nav">
                    <button class="btn" onclick="engine.previousVariation()">‚Üê Prev</button>
                    <button class="btn" onclick="engine.randomVariation()">Random</button>
                    <button class="btn" onclick="engine.nextVariation()">Next ‚Üí</button>
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Variation <span class="control-display" id="currentVariationDisplay">1</span>
                    </label>
                    <input type="range" id="variationSlider" class="control-input" min="0" max="99" value="0">
                </div>
                
                <div class="variation-info">
                    <div id="currentVariation">1 - TETRAHEDRON LATTICE 1</div>
                </div>
                
                <div class="variation-nav">
                    <button class="btn" onclick="engine.saveAsCustomVariation()">Save Custom</button>
                    <button class="btn" onclick="engine.openGalleryView()">Gallery</button>
                </div>
            </div>
            
            <div class="geometry-presets">
                <button class="btn active" data-geometry="0">Tetrahedron</button>
                <button class="btn" data-geometry="1">Hypercube</button>
                <button class="btn" data-geometry="2">Sphere</button>
                <button class="btn" data-geometry="3">Torus</button>
                <button class="btn" data-geometry="4">Klein Bottle</button>
                <button class="btn" data-geometry="5">Fractal</button>
                <button class="btn" data-geometry="6">Wave</button>
                <button class="btn" data-geometry="7">Crystal</button>
            </div>
        </div>
        
        <!-- 4D Math Tab -->
        <div class="tab-content" id="polytopal-tab">
            <div class="control-group">
                <label class="control-label">
                    4D Rotation XW <span class="control-display" id="rot4dXWDisplay">0.00</span>
                </label>
                <input type="range" id="rot4dXW" class="control-input" min="-2" max="2" step="0.01" value="0">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    4D Rotation YW <span class="control-display" id="rot4dYWDisplay">0.00</span>
                </label>
                <input type="range" id="rot4dYW" class="control-input" min="-2" max="2" step="0.01" value="0">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    4D Rotation ZW <span class="control-display" id="rot4dZWDisplay">0.00</span>
                </label>
                <input type="range" id="rot4dZW" class="control-input" min="-2" max="2" step="0.01" value="0">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Dimension <span class="control-display" id="dimensionDisplay">3.50</span>
                </label>
                <input type="range" id="dimension" class="control-input" min="3" max="4.5" step="0.01" value="3.5">
            </div>
            
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn" onclick="engine.randomizeAll()">Randomize All</button>
                <button class="btn" onclick="engine.resetToDefaults()">Reset</button>
            </div>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,255,255,0.3);">
                <h4 style="color: #00ffff; margin-bottom: 10px; font-size: 0.9rem;">‚öôÔ∏è System Controls</h4>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button class="btn" id="vib34dAudioToggle" onclick="toggleVIB34DAudio()" style="flex: 1; font-size: 0.7rem;">üéµ Audio Off</button>
                    <button class="btn" onclick="saveVIB34DToPortfolio()" style="flex: 1; font-size: 0.7rem; background: rgba(255,100,255,0.3); border-color: #ff64ff; color: #ff64ff;">üíæ Save</button>
                </div>
                <button class="btn" onclick="openUnifiedGallery()" style="width: 100%; font-size: 0.7rem; background: rgba(0,255,100,0.3); border-color: #00ff64; color: #00ff64;">üñºÔ∏è View Portfolio</button>
            </div>
        </div>
        
        <!-- Holographic Tab -->
        <div class="tab-content" id="holographic-tab">
            <div class="control-group">
                <label class="control-label">
                    Grid Density <span class="control-display" id="gridDensityDisplay">15.0</span>
                </label>
                <input type="range" id="gridDensity" class="control-input" min="4" max="30" step="0.1" value="15">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Morph Factor <span class="control-display" id="morphFactorDisplay">1.00</span>
                </label>
                <input type="range" id="morphFactor" class="control-input" min="0" max="2" step="0.01" value="1">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Chaos <span class="control-display" id="chaosDisplay">0.20</span>
                </label>
                <input type="range" id="chaos" class="control-input" min="0" max="1" step="0.01" value="0.2">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Speed <span class="control-display" id="speedDisplay">1.00</span>
                </label>
                <input type="range" id="speed" class="control-input" min="0.1" max="3" step="0.01" value="1">
            </div>
            
            <div class="control-group">
                <label class="control-label">
                    Hue <span class="control-display" id="hueDisplay">200¬∞</span>
                </label>
                <input type="range" id="hue" class="control-input" min="0" max="360" step="1" value="200">
            </div>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,255,255,0.3);">
                <h4 style="color: #00ffff; margin-bottom: 10px; font-size: 0.9rem;">‚öôÔ∏è System Controls</h4>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button class="btn" id="vib34dAudioToggle2" onclick="toggleVIB34DAudio()" style="flex: 1; font-size: 0.7rem;">üéµ Audio Off</button>
                    <button class="btn" onclick="saveVIB34DToPortfolio()" style="flex: 1; font-size: 0.7rem; background: rgba(255,100,255,0.3); border-color: #ff64ff; color: #ff64ff;">üíæ Save</button>
                </div>
                <button class="btn" onclick="openUnifiedGallery()" style="width: 100%; font-size: 0.7rem; background: rgba(0,255,100,0.3); border-color: #00ff64; color: #00ff64;">üñºÔ∏è View Portfolio</button>
            </div>
        </div>
        
        <!-- Active Holograms Tab -->
        <div class="tab-content" id="holograms-tab">
            <div class="control-group">
                <h3 style="color: #00ffff; margin-bottom: 15px;">Active Holographic System</h3>
                <div style="margin-bottom: 15px;">
                    <button class="btn" id="toggle-holo" onclick="toggleHolographicSystem()">Activate Holograms</button>
                </div>
            </div>
            
            <div class="variation-controls">
                <div class="variation-nav">
                    <button class="btn" onclick="holoSystem.previousVariant()">‚Üê Prev</button>
                    <button class="btn" onclick="holoSystem.randomVariant()">Random</button>
                    <button class="btn" onclick="holoSystem.nextVariant()">Next ‚Üí</button>
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Hologram Variant <span class="control-display" id="holoVariationDisplay">1</span>
                    </label>
                    <input type="range" id="holoVariationSlider" class="control-input" min="0" max="29" value="0" 
                           onchange="holoSystem.setVariant(parseInt(this.value)); updateHoloDisplay();">
                </div>
                
                <div class="variation-info">
                    <div id="currentHoloVariation">1 - TETRAHEDRON LATTICE</div>
                </div>
            </div>
            
            <div class="geometry-presets">
                <button class="btn holo-geom active" data-holo-geometry="0" onclick="setHoloGeometry(0)">Tetrahedron</button>
                <button class="btn holo-geom" data-holo-geometry="4" onclick="setHoloGeometry(4)">Hypercube</button>
                <button class="btn holo-geom" data-holo-geometry="8" onclick="setHoloGeometry(8)">Sphere</button>
                <button class="btn holo-geom" data-holo-geometry="12" onclick="setHoloGeometry(12)">Torus</button>
                <button class="btn holo-geom" data-holo-geometry="16" onclick="setHoloGeometry(16)">Klein Bottle</button>
                <button class="btn holo-geom" data-holo-geometry="20" onclick="setHoloGeometry(20)">Fractal</button>
                <button class="btn holo-geom" data-holo-geometry="23" onclick="setHoloGeometry(23)">Wave</button>
                <button class="btn holo-geom" data-holo-geometry="26" onclick="setHoloGeometry(26)">Crystal</button>
            </div>
            
            <!-- HOLOGRAPHIC PARAMETER CONTROLS -->
            <div style="margin-top: 20px; border-top: 1px solid rgba(0,255,255,0.3); padding-top: 15px;">
                <h4 style="color: #00ffff; margin-bottom: 10px;">üéõÔ∏è Holographic Parameters</h4>
                
                <div class="control-group">
                    <label class="control-label">
                        Density <span class="control-display" id="holoDensityDisplay">1.00</span>
                    </label>
                    <input type="range" id="holoDensity" class="control-input" min="0.5" max="3.0" step="0.1" value="1.0" 
                           oninput="updateHoloParameter('density', this.value)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Speed <span class="control-display" id="holoSpeedDisplay">0.50</span>
                    </label>
                    <input type="range" id="holoSpeed" class="control-input" min="0.1" max="2.0" step="0.1" value="0.5" 
                           oninput="updateHoloParameter('speed', this.value)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Chaos <span class="control-display" id="holoChaosDisplay">0.00</span>
                    </label>
                    <input type="range" id="holoChaos" class="control-input" min="0" max="1" step="0.05" value="0" 
                           oninput="updateHoloParameter('chaos', this.value)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Morph <span class="control-display" id="holoMorphDisplay">0.00</span>
                    </label>
                    <input type="range" id="holoMorph" class="control-input" min="0" max="1" step="0.05" value="0" 
                           oninput="updateHoloParameter('morph', this.value)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Hue <span class="control-display" id="holoHueDisplay">0¬∞</span>
                    </label>
                    <input type="range" id="holoHue" class="control-input" min="0" max="360" step="5" value="0" 
                           oninput="updateHoloParameter('hue', this.value)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Saturation <span class="control-display" id="holoSaturationDisplay">0.80</span>
                    </label>
                    <input type="range" id="holoSaturation" class="control-input" min="0" max="1" step="0.05" value="0.8" 
                           oninput="updateHoloParameter('saturation', this.value)">
                </div>
                
                <div class="control-group">
                    <label class="control-label">
                        Intensity <span class="control-display" id="holoIntensityDisplay">0.50</span>
                    </label>
                    <input type="range" id="holoIntensity" class="control-input" min="0.1" max="1" step="0.05" value="0.5" 
                           oninput="updateHoloParameter('intensity', this.value)">
                </div>
                
                <div style="margin-top: 15px;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button class="btn" id="holoAudioToggle" onclick="toggleHolographicAudio()" style="flex: 1; font-size: 0.7rem;">üéµ Audio On</button>
                        <button class="btn" onclick="saveHologramToPortfolio()" style="flex: 1; font-size: 0.7rem; background: rgba(255,100,255,0.3); border-color: #ff64ff; color: #ff64ff;">üíæ Save</button>
                    </div>
                    <button class="btn" onclick="openUnifiedGallery()" style="width: 100%; font-size: 0.7rem; background: rgba(0,255,100,0.3); border-color: #00ff64; color: #00ff64;">üñºÔ∏è View Portfolio</button>
                </div>
            </div>
            
            <div style="margin-top: 20px; font-size: 0.8rem; color: rgba(255,255,255,0.7);">
                <p>‚ú® Multi-layer holographic effects</p>
                <p>üé® Audio-reactive visualizations</p>
                <p>üîÆ 30 base variants + custom portfolio</p>
                <p>üñ±Ô∏è Mouse, touch, scroll, audio interactions</p>
            </div>
        </div>
        
        <!-- Export Tab -->
        <div class="tab-content" id="export-tab">
            <div class="control-group">
                <h3 style="color: #00ffff; margin-bottom: 10px;">Export</h3>
                <button class="btn" onclick="engine.exportJSON()" style="width: 100%; margin-bottom: 5px;">Export JSON Config</button>
                <button class="btn" onclick="engine.exportCSS()" style="width: 100%; margin-bottom: 5px;">Export CSS Theme</button>
                <button class="btn" onclick="engine.exportHTML()" style="width: 100%; margin-bottom: 5px;">Export HTML Page</button>
                <button class="btn" onclick="engine.exportPNG()" style="width: 100%; margin-bottom: 15px;">Export PNG Image</button>
            </div>
            
            <div class="control-group">
                <h3 style="color: #00ffff; margin-bottom: 10px;">Import</h3>
                <button class="btn" onclick="engine.importJSON()" style="width: 100%; margin-bottom: 5px;">Import JSON Config</button>
                <button class="btn" onclick="engine.importFolder()" style="width: 100%;">Import Folder</button>
            </div>
        </div>
    </div>
    
    <!-- Status Display -->
    <div id="status" class="status"></div>
    
    <!-- Load ES6 Modules -->
    <script type="module">
        // Check for preview mode
        const urlParams = new URLSearchParams(window.location.search);
        const isPreviewMode = urlParams.get('preview') === 'true' || urlParams.get('hideui') === 'true';
        
        if (isPreviewMode) {
            document.body.classList.add('preview-mode');
            console.log('üîç Preview mode activated - UI hidden');
        }
        
        // Load parameters from URL if available
        if (window.loadParametersFromURL) {
            loadParametersFromURL(urlParams);
        }
        
        // Add cache busting to prevent old file conflicts
        const cacheBuster = '?v=' + Date.now();
        
        // Load main VIB34D Engine
        import('./src/core/Engine.js' + cacheBuster).then(module => {
            const { VIB34DIntegratedEngine } = module;
            
            // Initialize VIB34D Engine
            window.engine = new VIB34DIntegratedEngine();
            
            console.log('üåå VIB34D Holographic Engine - Refactored Version Loaded');
            console.log('‚úÖ 5-Layer Holographic Rendering Active');
            console.log('üîÆ 100 Geometric Variations Available');
            console.log('üßÆ 4D Polytopal Mathematics Ready');
            console.log('üéÆ Interactive Controls Enabled');
        }).catch(error => {
            console.error('‚ùå Failed to load VIB34D Engine:', error);
            document.body.innerHTML += '<div style="color: red; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: black; padding: 20px; border: 1px solid red;">VIB34D Loading Error: ' + error.message + '</div>';
        });
        
        // Load REAL Holographic System for Active Holograms tab ONLY
        import('./src/holograms/RealHolographicSystem.js' + cacheBuster).then(module => {
            const { RealHolographicSystem } = module;
            
            // Initialize REAL Holographic System for the Active Holograms tab
            window.realHoloSystem = new RealHolographicSystem();
            
            console.log('‚ú® REAL Active Holographic System Loaded for Active Holograms tab');
            console.log('üîÆ 30 VIB3 Elaborate Holographic Variants with Complex Shaders');
        }).catch(error => {
            console.error('‚ùå Failed to load REAL Holographic System:', error);
        });
        
        // ================================
        // UNIFIED PARAMETER SYSTEM
        // ================================
        
        // Global parameter state shared across all systems
        window.unifiedParameters = {
            // Visual parameters (shared)
            density: 1.5,
            speed: 0.8,
            chaos: 0.3,
            morph: 0.5,
            hue: 200,
            saturation: 0.8,
            intensity: 0.6,
            
            // System-specific
            systemType: 'VIB34D', // 'VIB34D' or 'Holographic'
            variation: 0,
            geometryType: 0,
            
            // 4D Math (VIB34D only)
            rot4dXW: 0,
            rot4dYW: 0,
            rot4dZW: 0,
            dimension: 3.5,
            
            // Audio
            audioEnabled: false
        };
        
        // RANDOMIZATION SYSTEM
        window.randomizeParameters = function(systemType = null) {
            const targetSystem = systemType || unifiedParameters.systemType;
            
            console.log(`üé≤ Randomizing parameters for ${targetSystem} system`);
            
            // Randomize shared visual parameters
            const newParams = {
                density: 0.5 + Math.random() * 2.5,      // 0.5 - 3.0
                speed: 0.1 + Math.random() * 1.9,        // 0.1 - 2.0
                chaos: Math.random(),                     // 0.0 - 1.0
                morph: Math.random(),                     // 0.0 - 1.0
                hue: Math.floor(Math.random() * 360),     // 0 - 360
                saturation: 0.3 + Math.random() * 0.7,   // 0.3 - 1.0
                intensity: 0.2 + Math.random() * 0.8     // 0.2 - 1.0
            };
            
            // System-specific randomization
            if (targetSystem === 'VIB34D') {
                newParams.variation = Math.floor(Math.random() * 100);
                newParams.rot4dXW = (Math.random() - 0.5) * 4;  // -2 to +2
                newParams.rot4dYW = (Math.random() - 0.5) * 4;
                newParams.rot4dZW = (Math.random() - 0.5) * 4;
                newParams.dimension = 3.0 + Math.random() * 1.5; // 3.0 - 4.5
            } else if (targetSystem === 'Holographic') {
                newParams.geometryType = Math.floor(Math.random() * 8); // 0-7 geometry types
            }
            
            // Apply parameters
            applyUnifiedParameters(newParams, targetSystem);
            
            // Show notification
            showParameterNotification('üé≤ Parameters Randomized!', 'Generated new random variation');
        };
        
        // QUICK RANDOMIZE - just visual parameters
        window.quickRandomize = function() {
            const visualParams = {
                density: 0.5 + Math.random() * 2.5,
                speed: 0.1 + Math.random() * 1.9,
                chaos: Math.random(),
                hue: Math.floor(Math.random() * 360),
                saturation: 0.5 + Math.random() * 0.5,
                intensity: 0.3 + Math.random() * 0.7
            };
            
            applyUnifiedParameters(visualParams);
            showParameterNotification('‚ö° Quick Randomized!', 'Visual parameters shuffled');
        };
        
        // PARAMETER APPLICATION SYSTEM
        window.applyUnifiedParameters = function(newParams, targetSystem = null) {
            const system = targetSystem || unifiedParameters.systemType;
            
            // Update global state
            Object.assign(unifiedParameters, newParams);
            
            // Apply to UI sliders
            updateAllSliders(newParams, system);
            
            // Apply to active system
            if (system === 'VIB34D' && window.engine) {
                applyToVIB34D(newParams);
            } else if (system === 'Holographic' && window.realHoloSystem) {
                applyToHolographic(newParams);
            }
            
            console.log('üîÑ Applied unified parameters:', newParams);
        };
        
        // Update all UI sliders
        function updateAllSliders(params, system) {
            // Implementation for updating sliders
            console.log('Updating sliders:', params);
        }
        
        // Apply parameters to VIB34D system  
        function applyToVIB34D(params) {
            if (!window.engine) return;
            console.log('Applying to VIB34D:', params);
        }
        
        // Apply parameters to Holographic system
        function applyToHolographic(params) {
            if (!window.realHoloSystem) return;
            console.log('Applying to Holographic:', params);
        }
        
        // Parameter notification system
        function showParameterNotification(title, message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: linear-gradient(145deg, rgba(0, 255, 255, 0.9), rgba(0, 200, 255, 0.8));
                color: #000;
                padding: 12px 20px;
                border-radius: 8px;
                font-family: 'Orbitron', monospace;
                font-size: 0.8rem;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 4px 20px rgba(0, 255, 255, 0.3);
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 250px;
            `;
            
            notification.innerHTML = `
                <div style="margin-bottom: 4px;">${title}</div>
                <div style="font-size: 0.7rem; opacity: 0.8;">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // SYSTEM SWITCHING
        window.switchToSystem = function(systemType) {
            if (unifiedParameters.systemType === systemType) return;
            
            console.log(`üîÑ Switching to ${systemType} system`);
            unifiedParameters.systemType = systemType;
            
            // Update UI indicator
            const indicator = document.getElementById('currentSystemIndicator');
            if (indicator) {
                indicator.textContent = systemType === 'VIB34D' ? 'üî∑ VIB34D System' : '‚ú® Holographic System';
            }
            
            showParameterNotification(`üîÑ Switched to ${systemType}`, 'Parameters synchronized');
        };
        
        // Enhanced URL parameter loading
        window.loadParametersFromURL = function(urlParams) {
            console.log('üîó Loading parameters from URL...');
            // Implementation for loading URL parameters
        };
        
        // Collapsible Control Panel
        window.toggleControlPanel = function() {
            const panel = document.getElementById('controlPanel');
            const toggle = document.getElementById('collapseToggle');
            
            panel.classList.toggle('collapsed');
            
            if (panel.classList.contains('collapsed')) {
                toggle.textContent = '‚Ä∫';
                toggle.title = 'Expand Control Panel';
            } else {
                toggle.textContent = '‚Äπ';
                toggle.title = 'Collapse Control Panel';
            }
        };
        
        // Keyboard shortcut for panel collapse
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Tab' && e.ctrlKey) {
                e.preventDefault();
                toggleControlPanel();
            }
        });
        
        // Placeholder functions for compatibility
        window.toggleHolographicSystem = function() { console.log('Toggle holographic system'); };
        window.updateHoloParameter = function(param, value) { console.log('Update holo parameter:', param, value); };
        window.toggleVIB34DAudio = function() { console.log('Toggle VIB34D audio'); };
        window.toggleHolographicAudio = function() { console.log('Toggle holographic audio'); };
        window.saveVIB34DToPortfolio = function() { console.log('Save VIB34D to portfolio'); };
        window.saveHologramToPortfolio = function() { console.log('Save hologram to portfolio'); };
        window.openUnifiedGallery = function() { window.open('./unified-gallery.html', '_blank'); };
        
        // Holographic system interface
        window.holoSystem = {
            setVariant: function(variant) { console.log('Set variant:', variant); },
            nextVariant: function() { console.log('Next variant'); },
            previousVariant: function() { console.log('Previous variant'); },
            randomVariant: function() { console.log('Random variant'); }
        };
        
    </script>
</body>
</html>